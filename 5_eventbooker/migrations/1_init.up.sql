CREATE EXTENSION IF NOT EXISTS "uuid-ossp";
CREATE TABLE IF NOT EXISTS events (
	pk BIGSERIAL PRIMARY KEY,
	id UUID NOT NULL UNIQUE DEFAULT uuid_generate_v4(),
	name VARCHAR(255) NOT NULL,
	capacity BIGINT NOT NULL,
    available BIGINT NOT NULL,
	date TIMESTAMPTZ NOT NULL,
	payment_ttl INTEGER NOT NULL,
	created_at TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP,
	updated_at TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS bookings (
	id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
	event_id UUID NOT NULL REFERENCES events(id) ON DELETE CASCADE,
	user_id UUID NOT NULL,
	decremented BOOLEAN NOT NULL DEFAULT FALSE,
	created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
	updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    status VARCHAR(255) NOT NULL DEFAULT 'pending',
	payment_deadline TIMESTAMP NOT NULL
);

CREATE TABLE IF NOT EXISTS notifications (
	id UUID NOT NULL UNIQUE DEFAULT uuid_generate_v4(),
	user_id UUID NOT NULL,
	event_id UUID NOT NULL REFERENCES events(id) ON DELETE CASCADE,
	booking_id UUID NOT NULL REFERENCES bookings(id) ON DELETE CASCADE,
	send_at TIMESTAMPTZ NOT NULL,
	created_at TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP
);



